name: Check Update from SRS Repository

on:
  schedule:
    - cron: '30 2 * * *' # Runs daily at 2:30 AM
  workflow_dispatch:

jobs:
  check-and-trigger:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Make scripts executable
        run: chmod +x scripts/*.sh

      - name: Check SRS tags and trigger workflows if needed
        env:
          PAT_REPO_DISPATCH: ${{ secrets.PAT_REPO_DISPATCH }}
          GITHUB_REPOSITORY: ${{ github.repository }}
          DOCKERHUB_USERNAME: ${{ secrets.DOCKERHUB_USERNAME }}
        run: |
          # Validate required secrets are present
          if [ -z "$PAT_REPO_DISPATCH" ]; then
            echo "Error: PAT_REPO_DISPATCH secret is not set"
            exit 1
          fi
          if [ -z "$DOCKERHUB_USERNAME" ]; then
            echo "Error: DOCKERHUB_USERNAME secret is not set"  
            exit 1
          fi
          
          # Run the script which will:
          # 1. Get the latest SRS release tag
          # 2. Check if corresponding Docker Hub tags exist
          # 3. Automatically trigger workflows for missing tags
          scripts/check-git-release.sh
